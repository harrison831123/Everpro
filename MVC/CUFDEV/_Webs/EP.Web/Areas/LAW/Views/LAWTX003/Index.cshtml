
@{
    ViewBag.Title = LAWResource.承辦單位列表;
    Layout = "~/Views/Shared/_LayoutMenu.cshtml";
}

<div class="form-group row">
    <div class="col-md-3">
        <button class="btn btn-default group1" id="btnInsert" data-bind="click: InsertClick">@EP.PlatformResources.新增</button>
    </div>
</div>
<div class="row col-md-12">
    <table id="datatable" class="table">
        <thead>
            <tr>
                <th>@LAWResource.名稱</th>
                <th>@LAWResource.啟用狀態</th>
                <th>@LAWResource.建檔人員</th>
                <th>@LAWResource.建檔日期</th>
                <th>@EP.PlatformResources.刪除</th>
            </tr>
        </thead>
        <tbody id="datatbody">
        </tbody>
    </table>
</div>

<script>
    var ViewModel = {
        InsertClick: function () {
            location.href = '@Url.Action("Create", "LAWTX003", new { area = "LAW" })';
        },
    }
    $(document).ready(function () {
        ko.applyBindings(ViewModel);
        GetLawsys();
    });
    function GetLawsys() {
         $.ajax({
             method: "POST",
             cache: false,
             contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
             url: '@Url.Action("Query", "LAWTX003", new { area = "LAW" })',
             complete: function (data) {
                        console.log(data.responseJSON);
                        if (data.responseJSON === undefined) {
                        } else {
                            $(".remtr").remove();
                            $.each(data.responseJSON, function () {
                                let updateurl = '@Html.Raw(Url.Action("Update", "LAWTX003"))' + "?id=" + this.LawDoUnitId;
                                let str = "<tr class='remtr'><td>" + "<a href='" + updateurl + "' >" + this.UnitName + "</a>"+"</td><td>"
                                    + StatusTypeBTN(this.StatusType, this.LawDoUnitId) + "</td><td>"
                                    + this.CreateName + "</td><td>"
                                    + this.CreateDate + "</td><td>"
                                    + '<button id="delBtn" class="btn btn-danger" onclick="ConfirmDelete(\'' + this.LawDoUnitId + '\')">@EP.PlatformResources.刪除</button></td></tr>';
                                $("#datatbody").append(str);
                            });
                        }
             },
             error: function (ex) {
             if (ex.statusText == "OK") {
             } else {
                 appendMessage("@EP.PlatformResources.系統發生錯誤");
                 }
             }
         });
    }

    function ConfirmDelete(ID) {
            var result = confirm('@EP.PlatformResources.確定刪除?');
            if (result) {
                DeleteData(ID);
            }
    }
    function StatusTypeBTN(StatusType, ID) {
        if (StatusType == 0) {
            return '<button id="StatusTypeBtn' + ID + '" class="btn btn-default"  onclick="ChangeStatusType(\'' + 1 + '\',\'' + ID + '\')">@LAWResource.啟用</button>' + '<button id="StatusTypeStopBtn' + ID + '" class="btn btn-default" disabled="disabled" onclick="ChangeStatusType(\'' + 0 + '\',\'' + ID + '\')">@LAWResource.停用</button>';
        } else {
            return '<button id="StatusTypeBtn' + ID + '" class="btn btn-default"  disabled="disabled" onclick="ChangeStatusType(\'' + 1 + '\',\'' + ID + '\')">@LAWResource.啟用</button>' + '<button id="StatusTypeStopBtn' + ID + '" class="btn btn-default" onclick="ChangeStatusType(\'' + 0 + '\',\'' + ID + '\')">@LAWResource.停用</button>';
        }
    }
    function ChangeStatusType(StatusType, ID) {
        var str;
        if (StatusType == 0) {
            str = '@LAWResource.是否確定停用';
        }
        else {
            str = '@LAWResource.是否確定啟用';
        }
        var result = confirm(str);
        if (result) {
            if (StatusType == 0) {
                $("#StatusTypeBtn" + ID).attr('disabled', false);
                $("#StatusTypeStopBtn" + ID).attr('disabled', true);
            } else {
                $("#StatusTypeBtn" + ID).attr('disabled', true);
                $("#StatusTypeStopBtn" + ID).attr('disabled', false);
            }
            $.ajax({
                method: "POST",
                cache: false,
                data: { StatusType: StatusType, ID: ID },
                contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
                url: '@Url.Action("ChangeStatusType", "LAWTX003", new { area = "LAW" })',
                complete: function () {
                }
            });
        }
    }
    function DeleteData(ID) {
            $.ajax({
                method: "POST",
                cache: false,
                url: '@Url.Action("Delete", "LAWTX003", new { area = "LAW" })',
                data: { ID: ID },
                complete: function (data) {
                    GetLawsys();
                },
                error: function (ex) {
                    if (ex.statusText == "OK") {
                    } else {
                        appendMessage("@EP.PlatformResources.系統發生錯誤");
                    }
                }
            });
    }
</script>